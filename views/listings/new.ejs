<% layout("/layouts/boilerplate") %>

  <div class="row">
    <div class="col-8 offset-2">
        
  <form method="POST" action="/listings" novalidate class="needs-validation">
    <br>
    <h3>Create a New Listing</h3>
    <div class="mb-3">
      <label for="title" class="form-label">Title</label>
      <input name="listing[title]" placeholder="Enter title" type="text" class="form-control" required>
      <div class="invalid-feedback">Please Enter Title</div>
    </div>

    <div class="mb-3">
      <label for="description" class="form-label">Description</label>
      <textarea name="listing[description]" placeholder="Enter description" class="form-control" required></textarea>
      <div class="invalid-feedback">Please Enter Short Description</div>
    </div>

    <div class="mb-3">
      <label for="image" class="form-label">Image Link</label>
      <input name="listing[image]" placeholder="Enter image URL/Link" type="text" class="form-control">
    </div>
    <div class="row">
    <div class="mb-3 col-md-4">
      <label for="price" class="form-label">Price</label>  
      <input name="listing[price]" placeholder="Enter price" type="number" class="form-control" required>
      <div class="invalid-feedback">Price Should be Valid</div>
    </div>

    <div class="mb-3 col-md-8">
      <label for="country" class="form-label">Country</label>      
      <input name="listing[country]" placeholder="Enter country" type="text" class="form-control" required>
      <div class="invalid-feedback">Country Name Should be Valid</div>
    </div>
    </div>
    <div class="mb-3"> 
      <label for="location" class="form-label">Location</label>
      <div class="input-group">
        <input name="listing[location]" id="location" placeholder="Enter location or use live location" type="text" class="form-control" required>
        <button type="button" class="btn btn-outline-primary" onclick="getLocation()">
          üìç Use My Location
        </button>
      </div>
    </div>
    <br>
    <button class="btn btn-dark add-btn">Add</button>                    
  </form>
</div>
</div>




















<script>
function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition, showError);
  } else {
    alert("Geolocation is not supported by your browser.");
  }
}

function showPosition(position) {
  const lat = position.coords.latitude;
  const lon = position.coords.longitude;

  // Option 1: Show coordinates directly in input
  document.getElementById("location").value = `${lat}, ${lon}`;

  // Option 2 (recommended): Convert to readable address
  fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`)
    .then(response => response.json())
    .then(data => {
      document.getElementById("location").value = data.display_name;
    })
    .catch(() => {
      alert("Unable to fetch address. Using coordinates instead.");
      document.getElementById("location").value = `${lat}, ${lon}`;
    });
}

function showError(error) {
  switch(error.code) {
    case error.PERMISSION_DENIED:
      alert("You denied location access ‚Äî please enable it to use live location.");
      break;
    case error.POSITION_UNAVAILABLE:
      alert("Location information is unavailable.");
      break;
    case error.TIMEOUT:
      alert("Location request timed out.");
      break;
    default:
      alert("An unknown error occurred.");
  }
}
</script>
